<!DOCTYPE html>
<html>
<head>
    <title>Salesforce JWT Cert Generator</title>
</head>
<body>
<h2>Generate Salesforce JWT Certificate</h2>

<form id="f">
    CN: <input name="cn" value="salesforce-jwt"/><br/>
    Validity days: <input name="days" value="1200"/><br/>
    Keystore password: <input name="password" type="password"/><br/><br/>
    <button type="submit">Generate & Download</button>
</form>

<h3>NAIS secrets</h3>
<pre id="out"></pre>

<script>
    document.getElementById("f").onsubmit = async e => {
        e.preventDefault();

        const form = e.target;

        const body = new URLSearchParams({
            cn: form.cn.value,
            days: form.days.value,
            password: form.password.value
        });

        const res = await fetch("/internal/cert", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body
        });

        // ---- download cert ----
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "salesforce-jwt.cer";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        // ---- show secrets ----
        const jks = res.headers.get("X-KEYSTORE-JKS-B64");
        const pwd = res.headers.get("X-KEYSTORE-PASSWORD");

        document.getElementById("out").textContent =
            `SF_KEYSTORE_JKS_B64=${jks}
SF_KEYSTORE_PASSWORD=${pwd}

Upload salesforce-jwt.cer to:
Salesforce → Connected App → OAuth → Certificates`;
    };
</script>
</body>
</html>
